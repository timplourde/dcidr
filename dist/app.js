!function(o){"use strict";var t=o.dcidr=o.dcidr||{};t.Const={NAV:{NEXT:"nav-next",PREV:"nav-prev",ARCHIVE:"nav-archive"},EVENTS:{NEW_DECISION:"new",BUILD_REPORT:"build-report",EXIT:"exit",SAVE:"save",LOAD:"load",DELETE:"delete",PURGE_ARCHIVE:"purge-archive"}},ko.bindingHandlers.scoreBar={update:function(o,t){var n=ko.unwrap(t());setTimeout(function(){o.style.width=n.mine/n.best*90+"%"},500)}},ko.bindingHandlers.prettyDateFromString={update:function(o,t){var n=ko.unwrap(t()),i=new Date(n);return ko.bindingHandlers.text.update(o,function(){return i.getMonth()+1+"/"+i.getDate()+"/"+i.getFullYear()})}},ko.bindingHandlers.percentage={update:function(o,t){var n=ko.unwrap(t());return ko.bindingHandlers.text.update(o,function(){return(100*n).toFixed(2)+"%"})}},ko.bindingHandlers.enterKeyPress={init:function(o,t,n,i){ko.utils.registerEventHandler(o,"keypress",function(o){13===o.keyCode&&(o.preventDefault(),t().call(i))})}},t.Util={newId:function(){return(new Date).getTime().toString()}},t.Browser={scrollToTop:function(){window.scrollTo(0,0)},history:{push:function(o){history.pushState(o,document.title)},onPop:function(o){window.addEventListener("popstate",function(t){o(t.state)})}},storage:{isAvailable:function(){return"undefined"!=typeof window.localStorage},save:function(o,t){return this.isAvailable()?window.localStorage.setItem(o,t):void 0},retrieve:function(o){return this.isAvailable()?window.localStorage.getItem(o):void 0},destroy:function(o){return this.isAvailable()?window.localStorage.removeItem(o):void 0},empty:function(){return this.isAvailable()?window.localStorage.clear():void 0}}}}(window),function(o){"use strict";var t=o.dcidr=o.dcidr||{};t.Decision=function(o){var n,i,e,r,s,a,c,u,p=this,d=[];o=o||{},a=function(o){var t={};return ko.utils.arrayForEach(o,function(o){t[o.hash]=o}),t},c=function(o,t){return o.hash>t.hash?-1:o.hash<t.hash?1:0},u=function(){i(n(),p.optionComparisons)},r=function(o,t,n,i){this.criteria=o,this.optionA=t,this.optionB=n,this.rank=ko.observable(i||null),this.hash=this.criteria+"|"+this.optionA+"|"+this.optionB},s=function(o,t,n){this.criteriaA=o,this.criteriaB=t,this.rank=ko.observable(n||null),this.hash=this.criteriaA+"|"+this.criteriaB},n=function(){var o=[],t=p.options(),n=p.criteria();return ko.utils.arrayForEach(n,function(n){for(var i=0;i<t.length;i++)for(var e=i+1;e<t.length;e++)o.push(new r(n,t[i],t[e]))}),o},e=function(){for(var o=[],t=p.criteria(),n=0;n<t.length;n++)for(var i=n+1;i<t.length;i++)o.push(new s(t[n],t[i]));return o},i=function(o,t){var n=t(),i={},e={};i=a(o),e=a(n);for(var r in i)e[r]||n.push(i[r]);n=ko.utils.arrayFilter(n,function(o){return"undefined"!=typeof i[o.hash]}),t(n.sort(c))},p.id=o.id||t.Util.newId(),p.name=ko.observable(o.name||"Untitled"),p.date=o.date||new Date,p.options=ko.observableArray(o.options||[]),p.criteria=ko.observableArray(o.criteria||[]),p.optionComparisons=ko.observableArray(),o.optionComparisons&&ko.utils.arrayForEach(o.optionComparisons,function(o){p.optionComparisons.push(new r(o.criteria,o.optionA,o.optionB,o.rank))}),p.criteriaComparisons=ko.observableArray(),o.criteriaComparisons&&ko.utils.arrayForEach(o.criteriaComparisons,function(o){p.criteriaComparisons.push(new s(o.criteriaA,o.criteriaB,o.rank))}),p.report=ko.observableArray(o.report||[]),p.gates={options:ko.computed(function(){return p.options().length>=2}),criteria:ko.computed(function(){return p.criteria().length>=2}),optionComparisons:ko.computed(function(){var o=!0;return ko.utils.arrayForEach(p.optionComparisons(),function(t){null===t.rank()&&(o=!1)}),o}),criteriaComparisons:ko.computed(function(){var o=!0;return ko.utils.arrayForEach(p.criteriaComparisons(),function(t){null===t.rank()&&(o=!1)}),o})},p.gates.report=ko.computed(function(){return p.gates.options()&&p.gates.criteria()&&p.gates.optionComparisons()&&p.gates.criteriaComparisons()}),d.push(p.options.subscribe(function(){p.gates.options()&&p.gates.criteria()&&u()})),d.push(p.criteria.subscribe(function(){p.gates.options()&&p.gates.criteria()&&(u(),i(e(),p.criteriaComparisons))})),p.generateReport=function(){return p.gates.report()?(p.report(t.Report(ko.toJS(p))),!0):!1},p.export=function(){return ko.toJS({id:p.id,name:p.name,date:p.date,options:p.options,criteria:p.criteria,optionComparisons:p.optionComparisons,criteriaComparisons:p.criteriaComparisons,report:p.report})},p.dispose=function(){ko.utils.arrayForEach(d,function(o){o.dispose()})}}}(window),function(o){"use strict";var t=o.dcidr=o.dcidr||{};t.Report=function(o){function t(o){return o=ko.utils.arrayMap(o,function(o){o.rank=s[o.rank]})}function n(o){var t=[];for(var n in o)o.hasOwnProperty(n)&&t.push({option:n,score:o[n]});return t.sort(function(o,t){return o.score>t.score?-1:o.score<t.score?1:0})}function i(o,t,n){var i={},e=0,r=[];ko.utils.arrayForEach(o,function(o){var i={};i[n]=o[t],i[t]=o[n],i.rank=1/o.rank,r.push(i)}),o=o.concat(r),ko.utils.arrayForEach(o,function(o){e+=o.rank,i[o[t]]?i[o[t]]+=o.rank:i[o[t]]=o.rank});for(var s in i)i.hasOwnProperty(s)&&(i[s]=i[s]/e);return i}var e,r=o,s={},a={},c={},u=0;return s={mlt:.1,lt:.2,eq:1,gt:5,mgt:10},t(r.criteriaComparisons),t(r.optionComparisons),e=i(r.criteriaComparisons,"criteriaA","criteriaB"),ko.utils.arrayForEach(r.criteria,function(o){var t=ko.utils.arrayFilter(r.optionComparisons,function(t){return t.criteria===o});a[o]=i(t,"optionA","optionB")}),ko.utils.arrayForEach(r.options,function(o){c[o]=0;for(var t in e)if(e.hasOwnProperty(t)){{var n=e[t];a[t][o]}c[o]+=a[t][o]*n,u+=a[t][o]*n}}),n(c)}}(window),function(o){"use strict";var t=o.dcidr=o.dcidr||{};t.DecisionSerializer=function(){var o=this;o.toJSON=function(o){return JSON.stringify(o.export())},o.fromJSON=function(o){var n=JSON.parse(o);return new t.Decision(n)}},t.ListSerializer=function(){var o=this;o.toJSON=function(o){return JSON.stringify(o)},o.fromJSON=function(o){return JSON.parse(o)}},t.Archive=function(){function o(o){var t=s.toJSON(o);e.save(a,t)}function n(t){var n=i.getList();n=ko.utils.arrayFilter(n,function(o){return o.id!==t}),o(n)}var i=this,e=t.Browser.storage,r=new t.DecisionSerializer,s=new t.ListSerializer,a="decision-list";i.getList=function(){var o=e.retrieve(a);return o?s.fromJSON(o):[]},i.saveDecision=function(t){for(var n=i.getList(),s=-1,a=0;a<n.length;a++)if(n[a].id===t.id){s=a;break}-1===s?n.push({id:t.id,name:t.name(),date:t.date}):(n[s].name=t.name(),n[s].date=t.date),o(n);var c=r.toJSON(t);return e.save(t.id,c),t.id},i.getDecision=function(o){var t=e.retrieve(o);return t?r.fromJSON(t):(n(o),null)},i.deleteDecision=function(o){return n(o),e.destroy(o),!0},i.empty=function(){return e.empty(),!0}}}(window),function(o){"use strict";var t=o.dcidr=o.dcidr||{};t.Components=t.Components||{},t.Components.Welcome=function(o){this.getStarted=function(){ko.postbox.publish(t.Const.EVENTS.NEW_DECISION)},this.loadArchive=function(){ko.postbox.publish(t.Const.NAV.ARCHIVE)},this.isArchiveButtonVisible=o,this.isAboutSectionVisible=ko.observable(!1),this.showAbout=function(){this.isAboutSectionVisible(!0)}.bind(this)},t.Components.RankSetter=function(){this.setMlt=function(o){o.rank("mlt")},this.setLt=function(o){o.rank("lt")},this.setEq=function(o){o.rank("eq")},this.setGt=function(o){o.rank("gt")},this.setMgt=function(o){o.rank("mgt")}},t.Components.BaseWizardComponent=function(){this.proceed=function(){ko.postbox.publish(t.Const.NAV.NEXT)},this.goBack=function(){ko.postbox.publish(t.Const.NAV.PREV)}},t.Components.StringListEditor=function(o){var n=this;n=ko.utils.extend(n,new t.Components.BaseWizardComponent),n.items=o,n.newItem=ko.observable(),n.addItem=function(){var t=n.newItem();if(t&&(t=t.trim(),t.length)){var i=!1;ko.utils.arrayForEach(o(),function(o){o.toLowerCase()===t.toLowerCase()&&(i=!0)}),i||o.push(t),n.newItem("")}},n.removeItem=function(t){o.remove(t)}},t.Components.Options=function(o){var n=this;n=ko.utils.extend(n,new t.Components.StringListEditor(o.options)),n.canProceed=o.gates.options},t.Components.Criteria=function(o){var n=this;n=ko.utils.extend(n,new t.Components.StringListEditor(o.criteria)),n.canProceed=o.gates.criteria},t.Components.CompareOptions=function(o){var n=this;n=ko.utils.extend(n,new t.Components.BaseWizardComponent),n=ko.utils.extend(n,new t.Components.RankSetter),n.optionComparisons=o.optionComparisons,n.canProceed=o.gates.optionComparisons},t.Components.CompareCriteria=function(o){var n=this;n=ko.utils.extend(n,new t.Components.RankSetter),n.criteriaComparisons=o.criteriaComparisons,n.canProceed=o.gates.criteriaComparisons,this.proceed=function(){ko.postbox.publish(t.Const.EVENTS.BUILD_REPORT)},this.goBack=function(){ko.postbox.publish(t.Const.NAV.PREV)}},t.Components.Report=function(o){var n=this;this.proceed=function(){ko.postbox.publish(t.Const.NAV.NEXT)},this.goBack=function(){ko.postbox.publish(t.Const.NAV.PREV)},n.bestScore=o.report()[0].score,n.report=o.report},t.Components.SaveToArchive=function(o){var n=this;n.name=o.name,n.saveAndExit=function(){n.name().length&&(ko.postbox.publish(t.Const.EVENTS.SAVE),n.exit())},n.goBack=function(){ko.postbox.publish(t.Const.NAV.PREV)},n.exit=function(){ko.postbox.publish(t.Const.EVENTS.EXIT)}},t.Components.Archive=function(o){var n=this;n.decisions=ko.observableArray(o),n.isEmpty=ko.computed(function(){return 0===n.decisions().length}),n.load=function(o){ko.postbox.publish(t.Const.EVENTS.LOAD,o.id)},n.destroy=function(o){ko.postbox.publish(t.Const.EVENTS.DELETE,o.id),n.decisions.remove(o),0===n.decisions().length&&n.goHome()},n.destroyAll=function(){ko.postbox.publish(t.Const.EVENTS.PURGE_ARCHIVE)},n.goHome=function(){ko.postbox.publish(t.Const.EVENTS.EXIT)}}}(window),function(o){"use strict";var t=o.dcidr=o.dcidr||{};t.App=function(){var o=this,n={LOADING:"loading",WELCOME:"welcome",OPTIONS:"define-options",CRITERIA:"define-criteria",COMPARE_OPTIONS:"compare-options",COMPARE_CRITERIA:"compare-criteria",REPORT:"report",SAVE:"save-to-archive",ARCHIVE:"archive"},i="-template",e=[n.OPTIONS,n.CRITERIA,n.COMPARE_OPTIONS,n.COMPARE_CRITERIA,n.REPORT,n.SAVE],r={},s=new t.Archive;r[n.WELCOME]=t.Components.Welcome,r[n.OPTIONS]=t.Components.Options,r[n.CRITERIA]=t.Components.Criteria,r[n.COMPARE_OPTIONS]=t.Components.CompareOptions,r[n.COMPARE_CRITERIA]=t.Components.CompareCriteria,r[n.REPORT]=t.Components.Report,r[n.SAVE]=t.Components.SaveToArchive,r[n.ARCHIVE]=t.Components.Archive,o.currentView=ko.observable({name:n.LOADING+i}),o.decision=null,o.useWelcomeLayout=ko.computed(function(){return o.currentView()&&o.currentView().name&&o.currentView().name===n.WELCOME+i}),o.isTransitioning=ko.observable(!1),o.setCurrentView=function(n,e){o.isTransitioning(!0),setTimeout(function(){var s=o.currentView();s&&s.data&&s.data.dispose&&s.data.dispose();var a="function"==typeof r[n]?new r[n](e):{};o.currentView({nav:n,name:n+i,data:a}),t.Browser.history.push(n),o.isTransitioning(!1)},350)},t.Browser.history.onPop(function(n){"welcome"===n?o.exit():ko.postbox.publish(t.Const.NAV.PREV)}),o.newDecision=function(){o.decision&&o.decision.dispose(),o.decision=new t.Decision,o.setCurrentView(n.OPTIONS,o.decision)},o.loadReport=function(){return o.decision&&o.decision.generateReport()?(o.setCurrentView(n.REPORT,o.decision),!0):!1},o.saveCurrentDecisionToArchive=function(){s.saveDecision(o.decision)},o.deleteDecision=function(o){s.deleteDecision(o)},o.purgeArchive=function(){s.empty(),o.goToWelcome()},o.loadArchive=function(){var t=s.getList();o.setCurrentView(n.ARCHIVE,t)},o.loadDecision=function(t){o.decision=s.getDecision(t),o.setCurrentView(n.OPTIONS,o.decision)},o.exitCurrentDecision=function(){o.decision&&o.decision.dispose(),o.decision=null,o.goToWelcome()},o.goToWelcome=function(){var t=s.getList();o.setCurrentView(n.WELCOME,t.length)},ko.postbox.subscribe(t.Const.NAV.PREV,function(){var n=o.currentView().nav,i=e.indexOf(n);i>0?o.setCurrentView(e[i-1],o.decision):o.exitCurrentDecision(),t.Browser.scrollToTop()}),ko.postbox.subscribe(t.Const.NAV.NEXT,function(){var n=o.currentView().nav,i=e.indexOf(n);i===e.length-1?o.exitCurrentDecision():o.setCurrentView(e[i+1],o.decision),t.Browser.scrollToTop()}),ko.postbox.subscribe(t.Const.NAV.ARCHIVE,o.loadArchive),ko.postbox.subscribe(t.Const.EVENTS.NEW_DECISION,o.newDecision),ko.postbox.subscribe(t.Const.EVENTS.BUILD_REPORT,o.loadReport),ko.postbox.subscribe(t.Const.EVENTS.SAVE,o.saveCurrentDecisionToArchive),ko.postbox.subscribe(t.Const.EVENTS.EXIT,o.exitCurrentDecision),ko.postbox.subscribe(t.Const.EVENTS.DELETE,o.deleteDecision),ko.postbox.subscribe(t.Const.EVENTS.PURGE_ARCHIVE,o.purgeArchive),ko.postbox.subscribe(t.Const.EVENTS.LOAD,o.loadDecision),o.goToWelcome(),o.fake=function(){function t(o,t){return Math.floor(Math.random()*(t-o+1))+o}function n(o){var n=["eq","lt","mlt","gt","mgt"];return o.rank(n[t(0,n.length-1)])}function i(){o.newDecision(),o.decision.options(["NYC","Ski Trip","Beach","Gettysburg"]),o.decision.criteria(["Cost","Agony","Educational Value","Fun"]),ko.utils.arrayForEach(o.decision.criteriaComparisons(),n),ko.utils.arrayForEach(o.decision.optionComparisons(),n)}i(),o.loadReport()}}}(window);