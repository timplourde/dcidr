!function(){"use strict";ko.bindingHandlers.scoreBar={update:function(o,t){var n=ko.unwrap(t());setTimeout(function(){o.style.width=n.mine/n.best*90+"%"},500)}},ko.bindingHandlers.prettyDateFromString={update:function(o,t){var n=ko.unwrap(t()),i=new Date(n);return ko.bindingHandlers.text.update(o,function(){return i.getMonth()+1+"/"+i.getDate()+"/"+i.getFullYear()})}},ko.bindingHandlers.percentage={update:function(o,t){var n=ko.unwrap(t());return ko.bindingHandlers.text.update(o,function(){return(100*n).toFixed(2)+"%"})}},ko.bindingHandlers.enterKeyPress={init:function(o,t,n,i){ko.utils.registerEventHandler(o,"keypress",function(o){13===o.keyCode&&(o.preventDefault(),t().call(i))})}},ko.extenders.toggle=function(o){return o.toggle=function(){o(!o())},o}}(),function(o){"use strict";var t=o.dcidr=o.dcidr||{};t.const={NAV:{NEXT:"nav-next",PREV:"nav-prev",ARCHIVE:"nav-archive"},EVENTS:{NEW_DECISION:"new",BUILD_REPORT:"build-report",EXIT:"exit",SAVE:"save",LOAD:"load",DELETE:"delete",PURGE_ARCHIVE:"purge-archive"}},t.util={newId:function(){return(new Date).getTime().toString()}},t.browser={scrollToTop:function(){window.scrollTo(0,0)},history:{push:function(o){history.pushState(o,document.title)},onPop:function(o){window.addEventListener("popstate",function(t){o(t.state)})}},storage:{isAvailable:function(){return"undefined"!=typeof window.localStorage},save:function(o,t){return this.isAvailable()?window.localStorage.setItem(o,t):void 0},retrieve:function(o){return this.isAvailable()?window.localStorage.getItem(o):void 0},destroy:function(o){return this.isAvailable()?window.localStorage.removeItem(o):void 0},empty:function(){return this.isAvailable()?window.localStorage.clear():void 0}}}}(window),function(o){"use strict";var t=o.dcidr=o.dcidr||{};t.Decision=function(o){var n,i,e,r,s,a,c,u,p=this,d=[];o=o||{},a=function(o){var t={};return ko.utils.arrayForEach(o,function(o){t[o.hash]=o}),t},c=function(o,t){return o.hash>t.hash?-1:o.hash<t.hash?1:0},u=function(){i(n(),p.optionComparisons)},r=function(o,t,n,i){this.criteria=o,this.optionA=t,this.optionB=n,this.rank=ko.observable(i||null),this.hash=this.criteria+"|"+this.optionA+"|"+this.optionB},s=function(o,t,n){this.criteriaA=o,this.criteriaB=t,this.rank=ko.observable(n||null),this.hash=this.criteriaA+"|"+this.criteriaB},n=function(){var o=[],t=p.options(),n=p.criteria();return ko.utils.arrayForEach(n,function(n){for(var i=0;i<t.length;i++)for(var e=i+1;e<t.length;e++)o.push(new r(n,t[i],t[e]))}),o},e=function(){for(var o=[],t=p.criteria(),n=0;n<t.length;n++)for(var i=n+1;i<t.length;i++)o.push(new s(t[n],t[i]));return o},i=function(o,t){var n=t(),i={},e={};i=a(o),e=a(n);for(var r in i)e[r]||n.push(i[r]);n=ko.utils.arrayFilter(n,function(o){return"undefined"!=typeof i[o.hash]}),t(n.sort(c))},p.id=o.id||t.util.newId(),p.name=ko.observable(o.name||""),p.date=o.date||new Date,p.options=ko.observableArray(o.options||[]),p.criteria=ko.observableArray(o.criteria||[]),p.optionComparisons=ko.observableArray(),o.optionComparisons&&ko.utils.arrayForEach(o.optionComparisons,function(o){p.optionComparisons.push(new r(o.criteria,o.optionA,o.optionB,o.rank))}),p.criteriaComparisons=ko.observableArray(),o.criteriaComparisons&&ko.utils.arrayForEach(o.criteriaComparisons,function(o){p.criteriaComparisons.push(new s(o.criteriaA,o.criteriaB,o.rank))}),p.report=ko.observableArray(o.report||[]),p.gates={options:ko.computed(function(){return p.options().length>=2}),criteria:ko.computed(function(){return p.criteria().length>=2}),optionComparisons:ko.computed(function(){var o=!0;return ko.utils.arrayForEach(p.optionComparisons(),function(t){null===t.rank()&&(o=!1)}),o}),criteriaComparisons:ko.computed(function(){var o=!0;return ko.utils.arrayForEach(p.criteriaComparisons(),function(t){null===t.rank()&&(o=!1)}),o})},p.gates.report=ko.computed(function(){return p.gates.options()&&p.gates.criteria()&&p.gates.optionComparisons()&&p.gates.criteriaComparisons()}),d.push(p.options.subscribe(function(){p.gates.options()&&p.gates.criteria()&&u()})),d.push(p.criteria.subscribe(function(){p.gates.options()&&p.gates.criteria()&&(u(),i(e(),p.criteriaComparisons))})),p.generateReport=function(){if(p.gates.report()){var o=p.export();return p.report(t.report(o)),!0}return!1},p.export=function(){return ko.toJS({id:p.id,name:p.name,date:p.date,options:p.options,criteria:p.criteria,optionComparisons:p.optionComparisons,criteriaComparisons:p.criteriaComparisons,report:p.report})},p.dispose=function(){ko.utils.arrayForEach(d,function(o){o.dispose()})}}}(window),function(o){"use strict";var t=o.dcidr=o.dcidr||{};t.report=function(o){function t(o){return o=ko.utils.arrayMap(o,function(o){o.rank=s[o.rank]})}function n(o){var t=[];for(var n in o)o.hasOwnProperty(n)&&t.push({option:n,score:o[n]});return t.sort(function(o,t){return o.score>t.score?-1:o.score<t.score?1:0})}function i(o,t,n){var i={},e=0,r=[];ko.utils.arrayForEach(o,function(o){var i={};i[n]=o[t],i[t]=o[n],i.rank=1/o.rank,r.push(i)}),o=o.concat(r),ko.utils.arrayForEach(o,function(o){e+=o.rank,i[o[t]]?i[o[t]]+=o.rank:i[o[t]]=o.rank});for(var s in i)i.hasOwnProperty(s)&&(i[s]=i[s]/e);return i}var e,r=o,s={},a={},c={},u=0;return s={mlt:.1,lt:.2,eq:1,gt:5,mgt:10},t(r.criteriaComparisons),t(r.optionComparisons),e=i(r.criteriaComparisons,"criteriaA","criteriaB"),ko.utils.arrayForEach(r.criteria,function(o){var t=ko.utils.arrayFilter(r.optionComparisons,function(t){return t.criteria===o});a[o]=i(t,"optionA","optionB")}),ko.utils.arrayForEach(r.options,function(o){c[o]=0;for(var t in e)if(e.hasOwnProperty(t)){{var n=e[t];a[t][o]}c[o]+=a[t][o]*n,u+=a[t][o]*n}}),n(c)}}(window),function(o){"use strict";function t(o){var t=u.toJSON(o);d.save(l,t)}function n(o){var n=i();n=ko.utils.arrayFilter(n,function(t){return t.id!==o}),t(n)}function i(){var o=d.retrieve(l);return o?u.fromJSON(o):[]}function e(o){for(var n=i(),e=-1,r=0;r<n.length;r++)if(n[r].id===o.id){e=r;break}-1===e?n.push({id:o.id,name:o.name(),date:o.date}):(n[e].name=o.name(),n[e].date=o.date),t(n);var s=c.toJSON(o);return d.save(o.id,s),o.id}function r(o){var t=d.retrieve(o);return t?c.fromJSON(t):(n(o),null)}function s(o){return n(o),d.destroy(o),!0}function a(){return d.empty(),!0}var c,u,p=o.dcidr=o.dcidr||{},d=p.browser.storage,l="decision-list";c={toJSON:function(o){return JSON.stringify(o.export())},fromJSON:function(o){var t=JSON.parse(o);return new p.Decision(t)}},u={toJSON:function(o){return JSON.stringify(o)},fromJSON:function(o){return JSON.parse(o)}},p.archive={getList:i,saveDecision:e,getDecision:r,deleteDecision:s,empty:a}}(window),function(o){"use strict";var t=o.dcidr=o.dcidr||{};t.components=t.components||{},t.components.Welcome=function(o){this.getStarted=function(){ko.postbox.publish(t.const.EVENTS.NEW_DECISION)},this.loadArchive=function(){ko.postbox.publish(t.const.NAV.ARCHIVE)},this.isArchiveButtonVisible=o||!1,this.isAboutSectionVisible=ko.observable(!1).extend({toggle:!0})},t.components.RankSetter=function(){this.setMlt=function(o){o.rank("mlt")},this.setLt=function(o){o.rank("lt")},this.setEq=function(o){o.rank("eq")},this.setGt=function(o){o.rank("gt")},this.setMgt=function(o){o.rank("mgt")}},t.components.BaseWizardComponent=function(){this.proceed=function(){ko.postbox.publish(t.const.NAV.NEXT)},this.goBack=function(){ko.postbox.publish(t.const.NAV.PREV)},this.showHelp=ko.observable(!1).extend({toggle:!0})},t.components.StringListEditor=function(o){var n=this;n=ko.utils.extend(n,new t.components.BaseWizardComponent),n.items=o,n.newItem=ko.observable(),n.addItem=function(){var t=n.newItem();if(t&&(t=t.trim(),t.length)){var i=!1;ko.utils.arrayForEach(o(),function(o){o.toLowerCase()===t.toLowerCase()&&(i=!0)}),i||o.push(t),n.newItem("")}},n.removeItem=function(t){o.remove(t)}},t.components.Options=function(o){var n=this;n=ko.utils.extend(n,new t.components.StringListEditor(o.options)),n.canProceed=o.gates.options},t.components.Criteria=function(o){var n=this;n=ko.utils.extend(n,new t.components.StringListEditor(o.criteria)),n.canProceed=o.gates.criteria},t.components.CompareOptions=function(o){var n=this;n=ko.utils.extend(n,new t.components.BaseWizardComponent),n=ko.utils.extend(n,new t.components.RankSetter),n.optionComparisons=o.optionComparisons,n.canProceed=o.gates.optionComparisons},t.components.CompareCriteria=function(o){var n=this;n=ko.utils.extend(n,new t.components.RankSetter),n.criteriaComparisons=o.criteriaComparisons,n.canProceed=o.gates.criteriaComparisons,n.hasMultiple=n.criteriaComparisons().length>1,this.proceed=function(){ko.postbox.publish(t.const.EVENTS.BUILD_REPORT)},this.goBack=function(){ko.postbox.publish(t.const.NAV.PREV)}},t.components.Report=function(o){var n=this;this.proceed=function(){ko.postbox.publish(t.const.NAV.NEXT)},this.goBack=function(){ko.postbox.publish(t.const.NAV.PREV)},n.report=o.report,n.bestScore=o.report()[0].score},t.components.SaveToArchive=function(o){var n=this;n.name=o.name,n.okToSave=ko.computed(function(){return n.name().length}),n.saveAndExit=function(){n.okToSave()&&(ko.postbox.publish(t.const.EVENTS.SAVE),n.exit())},n.goBack=function(){ko.postbox.publish(t.const.NAV.PREV)},n.exit=function(){ko.postbox.publish(t.const.EVENTS.EXIT)}},t.components.Archive=function(o){var n=this;n.decisions=ko.observableArray(o),n.isEmpty=ko.computed(function(){return 0===n.decisions().length}),n.load=function(o){ko.postbox.publish(t.const.EVENTS.LOAD,o.id)},n.destroy=function(o){ko.postbox.publish(t.const.EVENTS.DELETE,o.id),n.decisions.remove(o),0===n.decisions().length&&n.goHome()},n.destroyAll=function(){ko.postbox.publish(t.const.EVENTS.PURGE_ARCHIVE)},n.goHome=function(){ko.postbox.publish(t.const.EVENTS.EXIT)}}}(window),function(o){"use strict";var t=o.dcidr=o.dcidr||{};t.App=function(){function o(){return t.archive.getList()}function n(){t.archive.saveDecision(f.decision)}function i(o){t.archive.deleteDecision(o)}function e(o){f.decision=t.archive.getDecision(o),f.setCurrentView(h.OPTIONS,f.decision)}function r(){var t=o();f.setCurrentView(h.ARCHIVE,t)}function s(){t.archive.empty(),f.goToWelcomeView()}function a(){u(),f.decision=new t.Decision,f.setCurrentView(h.OPTIONS,f.decision)}function c(){return f.decision&&f.decision.generateReport()?(f.setCurrentView(h.REPORT,f.decision),!0):!1}function u(){f.decision&&f.decision.dispose()}function p(){u(),f.decision=null,f.goToWelcomeView()}function d(){var o=f.currentView().nav,n=E.indexOf(o);n>0?f.setCurrentView(E[n-1],f.decision):p(),t.browser.scrollToTop()}function l(){var o=f.currentView().nav,n=E.indexOf(o);n===E.length-1?p():f.setCurrentView(E[n+1],f.decision),t.browser.scrollToTop()}var f=this,h={LOADING:"loading",WELCOME:"welcome",OPTIONS:"define-options",CRITERIA:"define-criteria",COMPARE_OPTIONS:"compare-options",COMPARE_CRITERIA:"compare-criteria",REPORT:"report",SAVE:"save-to-archive",ARCHIVE:"archive"},m="-template",E=[h.OPTIONS,h.CRITERIA,h.COMPARE_OPTIONS,h.COMPARE_CRITERIA,h.REPORT,h.SAVE],v={},b=[];v[h.WELCOME]=t.components.Welcome,v[h.OPTIONS]=t.components.Options,v[h.CRITERIA]=t.components.Criteria,v[h.COMPARE_OPTIONS]=t.components.CompareOptions,v[h.COMPARE_CRITERIA]=t.components.CompareCriteria,v[h.REPORT]=t.components.Report,v[h.SAVE]=t.components.SaveToArchive,v[h.ARCHIVE]=t.components.Archive,f.currentView=ko.observable({name:h.LOADING+m}),f.decision=null,f.useWelcomeLayout=ko.computed(function(){return f.currentView()&&f.currentView().name&&f.currentView().name===h.WELCOME+m}),f.isTransitioning=ko.observable(!1),f.setCurrentView=function(o,n){f.isTransitioning(!0),setTimeout(function(){var i=f.currentView();i&&i.data&&i.data.dispose&&i.data.dispose();var e="function"==typeof v[o]?new v[o](n):{};f.currentView({nav:o,name:o+m,data:e}),t.browser.history.push(o),f.isTransitioning(!1)},350)},f.goToWelcomeView=function(){var t=o();f.setCurrentView(h.WELCOME,t.length)},f.dispose=function(){ko.utils.arrayForEach(b,function(o){o.dispose()})},f.init=f.goToWelcomeView,t.browser.history.onPop(d),b.push(ko.postbox.subscribe(t.const.NAV.PREV,d)),b.push(ko.postbox.subscribe(t.const.NAV.NEXT,l)),b.push(ko.postbox.subscribe(t.const.NAV.ARCHIVE,r)),b.push(ko.postbox.subscribe(t.const.EVENTS.NEW_DECISION,a)),b.push(ko.postbox.subscribe(t.const.EVENTS.BUILD_REPORT,c)),b.push(ko.postbox.subscribe(t.const.EVENTS.SAVE,n)),b.push(ko.postbox.subscribe(t.const.EVENTS.EXIT,p)),b.push(ko.postbox.subscribe(t.const.EVENTS.DELETE,i)),b.push(ko.postbox.subscribe(t.const.EVENTS.PURGE_ARCHIVE,s)),b.push(ko.postbox.subscribe(t.const.EVENTS.LOAD,e)),f.fake=function(){function o(o,t){return Math.floor(Math.random()*(t-o+1))+o}function t(t){var n=["eq","lt","mlt","gt","mgt"];return t.rank(n[o(0,n.length-1)])}function n(){a(),f.decision.options(["NYC","Ski Trip","Beach","Gettysburg"]),f.decision.criteria(["Cost","Agony","Educational Value","Fun"]),ko.utils.arrayForEach(f.decision.criteriaComparisons(),t),ko.utils.arrayForEach(f.decision.optionComparisons(),t)}n(),c()}}}(window);